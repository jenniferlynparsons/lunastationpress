---
import BookCard from './BookCard.astro';
import { getCollection } from 'astro:content';

// Get all books from the content collection
const allBooks = await getCollection('books');

// Get books marked as featured on home page
const homePageFeatured = allBooks
  .filter(book => book.data.featuredOnHome)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

// If no books marked as featured, fall back to the 3 most recent books
const featuredBooks = homePageFeatured.length > 0 
  ? homePageFeatured 
  : allBooks
      .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
      .slice(0, 3);
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
  {featuredBooks.map((book) => (
    <BookCard 
      book={book}
      variant="featured"
      showAuthor={true}
      preferCoverImage={true}
    />
  ))}
</div>
