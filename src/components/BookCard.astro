---
import ImageLoader from './ImageLoader.astro';

interface Props {
  book: any; // Use any for flexibility with different content collection structures
  variant?: "grid" | "horizontal" | "featured";
  showBadge?: boolean;
  showAuthor?: boolean;
  showTag?: boolean;
  showReadMore?: boolean;
  imageClass?: string;
  titleClass?: string;
  containerClass?: string;
  preferCoverImage?: boolean;
}

const {
  book,
  variant = "grid",
  showBadge = false,
  showAuthor = true,
  showTag = false,
  showReadMore = false,
  imageClass = "",
  titleClass = "",
  containerClass = "",
  preferCoverImage = false
} = Astro.props;

// Determine image to use and which folder to look in
let imageToUse = "";
let imageFolder: "cover-images" | "cover-heros" | "hero-images" = "cover-images";

if (preferCoverImage) {
  // Force use of cover image even if hero image exists
  imageToUse = book.data.coverImage;
  imageFolder = "cover-images";
} else if (book.data.heroImage) {
  // Use hero image if available and not forcing cover image
  imageToUse = book.data.heroImage;
  imageFolder = "cover-heros";
} else {
  // Default to cover image
  imageToUse = book.data.coverImage;
  imageFolder = "cover-images";
}
const altText = `Cover of ${book.data.title}`;

// Handle different variants
const isGrid = variant === "grid";
const isHorizontal = variant === "horizontal";
const isFeatured = variant === "featured";
---

{isGrid && (
  <a href={`/books/${book.slug}`} class={`book-item cursor-pointer block ${containerClass}`} data-genre={book.data.genre}>
    <div class="relative overflow-hidden">
      <!-- Book Cover -->
      <div class="bg-gray-200 overflow-hidden">
        {imageToUse ? (
          <ImageLoader 
            folder={imageFolder}
            imagePath={imageToUse} 
            altText={altText}
            className={`w-full h-auto ${imageClass}`}
            errorMode="warn"
          />
        ) : (
          <div class="w-full h-64 flex items-center justify-center bg-gradient-to-br from-purple-400 to-blue-500 text-white">
            <span class="text-lg font-bold text-center px-4">{book.data.title}</span>
          </div>
        )}
      </div>
      
      <!-- New Release Badge -->
      {showBadge && (
        <div class="absolute left-[-45px] top-[20px] bg-blue text-white px-10 py-1 transform -rotate-45">
          <span class=" text-white text-xs font-bold  whitespace-nowrap">
            New Release
          </span>
        </div>
      )}
    </div>
    
    <!-- Book Title -->
    <div class="mt-4 text-center">
      <h3 class={`text-lg font-semibold text-gray-900 ${titleClass}`}>
        {book.data.title}
      </h3>
      {showAuthor && book.data.author && (
        <p class="text-sm text-gray-600 mt-1">by {book.data.author}</p>
      )}
    </div>
  </a>
)}

{isHorizontal && (
  <div class={`flex flex-col sm:flex-row sm:items-start lg:items-start ${containerClass}`}>
    <div class="w-full sm:w-1/2 mb-4 sm:mb-0 flex justify-center sm:justify-start">
      <div class="max-w-48 sm:max-w-none relative">
        <a href={`/books/${book.slug}/`}>
          <ImageLoader 
            folder={imageFolder}
            imagePath={imageToUse} 
            altText={altText}
            className={imageClass}
            errorMode="warn"
          />
        </a>
        <!-- New Release Badge -->
        {showBadge && (
          <div class="absolute top-0 left-0 w-0 h-0 border-t-[60px] border-r-[60px] border-t-blue-500 border-r-transparent">
            <span class="absolute -top-12 left-1 text-white text-xs font-bold transform -rotate-45 whitespace-nowrap">
              New Release
            </span>
          </div>
        )}
      </div>
    </div>
    <div class="w-full sm:w-1/2 book-info sm:ml-6 lg:ml-8 text-center sm:text-left">
      <h3 class={`!mt-0 mb-2 not-prose font-bold text-xl sm:text-2xl text-jlp-burnt ${titleClass}`}>
        <a href={`/books/${book.slug}/`}>{book.data.title}</a>
      </h3>
      {showTag && book.data.tag && (
        <p class="text-sm sm:text-base">{book.data.tag}</p>
      )}
      {showAuthor && book.data.author && (
        <p class="text-sm sm:text-base text-gray-600">by {book.data.author}</p>
      )}
      {showReadMore && (
        <a class="read-more text-sm sm:text-base" href={`/books/${book.slug}/`}>
          Learn more â†’
        </a>
      )}
    </div>
  </div>
)}

{isFeatured && (
  <article class={`cursor-pointer ${containerClass}`}>
    <a href={`/books/${book.slug}`} class="block">
      <div class="bg-white overflow-hidden relative">
        <div class="flex justify-center p-4">
          <div class="w-3/4">
            <ImageLoader 
              folder={imageFolder}
              imagePath={imageToUse} 
              altText={altText}
              className={`w-full h-auto ${imageClass}`}
              errorMode="warn"
            />
          </div>
        </div>
        <!-- New Release Badge -->
        {showBadge && (
          <div class="absolute top-0 left-0 w-0 h-0 border-t-[60px] border-r-[60px] border-t-blue-500 border-r-transparent">
            <span class="absolute -top-12 left-1 text-white text-xs font-bold transform -rotate-45 whitespace-nowrap">
              New Release
            </span>
          </div>
        )}
        <div class="p-6 text-center">
          <h3 class={`text-3xl font-semibold mb-2 text-gray-800 ${titleClass}`}>{book.data.title}</h3>
          {showAuthor && book.data.author && (
            <p class="text-sm text-gray-600">by {book.data.author}</p>
          )}
        </div>
      </div>
    </a>
  </article>
)}