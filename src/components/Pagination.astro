---
export interface Props {
  page: {
    url: {
      prev?: string;
      next?: string;
    };
    currentPage: number;
    lastPage: number;
    data: any[];
    start: number;
    end: number;
    total: number;
  };
  baseUrl?: string;
}

const { page, baseUrl = "/blog" } = Astro.props;

// Generate page numbers to show (max 7 pages: prev, 1, ..., current-1, current, current+1, ..., last, next)
const generatePageNumbers = (): (number | string)[] => {
  const pages: (number | string)[] = [];
  const { currentPage, lastPage } = page;
  
  // Always show first page
  if (currentPage > 3) {
    pages.push(1);
    if (currentPage > 4) {
      pages.push('...');
    }
  }
  
  // Show pages around current page
  for (let i = Math.max(1, currentPage - 1); i <= Math.min(lastPage, currentPage + 1); i++) {
    pages.push(i);
  }
  
  // Always show last page
  if (currentPage < lastPage - 2) {
    if (currentPage < lastPage - 3) {
      pages.push('...');
    }
    pages.push(lastPage);
  }
  
  return pages;
};

const pageNumbers = generatePageNumbers();

const getPageUrl = (pageNum: number) => {
  if (pageNum === 1) {
    return baseUrl === "/blog" ? "/blog" : baseUrl;
  }
  return `${baseUrl}/${pageNum}`;
};
---

{page.lastPage > 1 && (
  <nav class="flex justify-center items-center space-x-2 mt-8" aria-label="Pagination">
    <!-- Previous Page -->
    {page.url.prev ? (
      <a 
        href={page.url.prev} 
        class="px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700"
        aria-label="Previous page"
      >
        Previous
      </a>
    ) : (
      <span class="px-4 py-2 text-sm font-medium text-gray-300 dark:text-gray-600 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md cursor-not-allowed">
        Previous
      </span>
    )}

    <!-- Page Numbers -->
    <div class="flex space-x-1">
      {pageNumbers.map(pageNum => (
        pageNum === '...' ? (
          <span class="px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400">...</span>
        ) : pageNum === page.currentPage ? (
          <span 
            class="px-3 py-2 text-sm font-medium text-white bg-blue-600 dark:bg-blue-700 border border-blue-600 dark:border-blue-700 rounded-md"
            aria-current="page"
          >
            {pageNum}
          </span>
        ) : (
          <a 
            href={getPageUrl(pageNum as number)} 
            class="px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700"
            aria-label={`Go to page ${pageNum}`}
          >
            {pageNum}
          </a>
        )
      ))}
    </div>

    <!-- Next Page -->
    {page.url.next ? (
      <a 
        href={page.url.next} 
        class="px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700"
        aria-label="Next page"
      >
        Next
      </a>
    ) : (
      <span class="px-4 py-2 text-sm font-medium text-gray-300 dark:text-gray-600 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md cursor-not-allowed">
        Next
      </span>
    )}
  </nav>

  <!-- Page Info -->
  <div class="text-center text-sm text-gray-500 dark:text-gray-400 mt-4">
    Showing {page.start + 1} to {page.end + 1} of {page.total} posts
  </div>
)}