---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
  folder: "cover-images" | "cover-heros" | "hero-images";
  imagePath: string;
  altText: string;
  className?: string;
  loading?: "lazy" | "eager";
  errorMode?: "throw" | "warn" | "silent";
}

const { 
  folder, 
  imagePath, 
  altText, 
  className = "", 
  loading = "lazy",
  errorMode = "throw"
} = Astro.props;

// Handle undefined or empty imagePath
if (!imagePath) {
  const message = `ImageLoader component requires a valid imagePath, received: ${imagePath}`;
  if (errorMode === "throw") {
    throw new Error(message);
  } else if (errorMode === "warn") {
    console.warn(message);
  }
  // Return null fragment if no image path and not throwing
  return null;
}

// Build the full image path
const fullImagePath = `/src/assets/${folder}/${imagePath}`;
const images = import.meta.glob<{ default: ImageMetadata }>([
  "/src/assets/cover-images/*.{jpeg,jpg,png,gif}",
  "/src/assets/cover-heros/*.{jpeg,jpg,png,gif}",
  "/src/assets/hero-images/*.{jpeg,jpg,png,gif}"
]);

// Check if image exists
const imageExists = images[fullImagePath];
if (!imageExists) {
  const message = `Image "${fullImagePath}" does not exist. Available images: ${Object.keys(images).filter(key => key.includes(folder)).join(", ")}`;
  
  if (errorMode === "throw") {
    throw new Error(message);
  } else if (errorMode === "warn") {
    console.warn(message);
  }
  
  // Return null if image doesn't exist and we're not throwing
  return null;
}

// Get the image
const imageModule = await imageExists();
---

<Image 
  src={imageModule.default} 
  alt={altText} 
  class={className}
  loading={loading}
/>